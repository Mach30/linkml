[tox]
requires =
    tox>=4
envlist = 
     lint
     py

[testenv]
# Running tests via poetry within the tox environment is not the ideal
# situation, but without it you don't get dev dependencies in the 
# tox environment. There are other workaround, but most involve using
# extraneous dependency extras or maintaining a duplicate list of test
# dependencies. See:
#   - https://github.com/python-poetry/poetry/issues/1941
#   - https://python-poetry.org/docs/faq/#is-tox-supported
allowlist_externals = poetry
deps = 
    pytest
commands =
    poetry install --no-root --sync
    poetry run pytest 

[testenv:codespell]
description = Run spell checker.
skip_install = true
deps = 
    codespell
    tomli  # required for getting config from pyproject.toml
commands = codespell

[testenv:format]
description = Run code formatters.
skip_install = true
deps =
    isort
    black
commands =
    black linkml/ tests/
    isort linkml/ tests/

[testenv:lint]
description = Run code linters.
skip_install = true
deps =
    flake8
commands =
    flake8 linkml/ tests/

[flake8]
exclude = 
    .git,
    __pycache__,
    tests/output,
    tests/**/output
max-line-length = 120
extend-ignore = E203
per-file-ignores = 
    linkml/generators/sqlalchemy/sqlalchemy_declarative_template.py: E501
    linkml/generators/sqlalchemy/sqlalchemy_imperative_template.py: E501
    tests/test_notebooks/input/*: E402
